<!DOCTYPE html>
<html lang="pt-br">
	<head>
	  <meta charset="UTF-8">
	  <meta name="viewport" content="width=device-width, initial-scale=1.0">
	  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
	  <title>Lista de Repositórios</title>
	  <style>
	    body {
	      font-family: Arial, sans-serif;
	      margin: 0;
	      padding: 0;
	      background-color: #f6f8fa;
	    }

	    /* Barra de navegação superior */
	    .navbar {
	      background-color: #24292f;
	      color: white;
	      padding: 10px 20px;
	      display: flex;
	      justify-content: space-between;
	      align-items: center;
	      position: relative;
	    }

	    .navbar .logo {
	      font-size: 24px;
	      font-weight: bold;
	    }

	    .navbar .search-bar {
	      display: flex;
	      justify-content: center;
	      align-items: center;
	      flex: 1;
	      margin: 0 20px;
	    }

	    .navbar .search-bar input {
	      padding: 5px 15px;
	      border: 1px solid #ccc;
	      border-radius: 20px;
	      width: 400px;
	    }

	    /* Botão de usuário/login */
	    .navbar .login-btn {
	      background-color: #2c974b;
	      color: white;
	      padding: 8px 16px;
	      border-radius: 20px;
	      text-decoration: none;
	      transition: background-color 0.3s;
	    }

	    .navbar .login-btn:hover {
	      background-color: #238a3b;
	    }

	    /* Sidebar */
	    .sidebar {
	      width: 250px;
	      background-color: #24292f;
	      color: white;
	      height: 100vh;
	      position: fixed;
	      top: 0;
	      left: 0;
	      padding-top: 20px;
	      display: flex;
	      flex-direction: column;
	    }

	    .sidebar a {
	      color: white;
	      text-decoration: none;
	      padding: 12px 20px;
	      border-bottom: 1px solid #444;
	      transition: background-color 0.3s;
	    }

	    .sidebar a:hover {
	      background-color: #444;
	    }

	    /* Conteúdo principal */
	    .content {
	      margin-left: 270px;
	      padding: 20px;
	    }

	    .content .title {
	      font-size: 28px;
	      margin-bottom: 20px;
	    }

	    /* Tabela de repositórios */
	    .repo-table {
	      width: 50%;
	      border-collapse: collapse;
	    }

	    .repo-table th, .repo-table td {
	      padding: 12px 15px;
	      border: 1px solid #ddd;
	      text-align: left;
	    }

	    .repo-table th {
	      background-color: #24292f;
	      color: white;
	    }

	    .repo-table tr:nth-child(even) {
	      background-color: #f9f9f9;
	    }

	    .repo-table tr:hover {
	      background-color: #f1f1f1;
	    }

	    /* Botão de ação para cada repositório */
	    .view-repo-btn {
	      background-color: #2c974b;
	      color: white;
	      padding: 8px 16px;
	      border-radius: 6px;
	      text-decoration: none;
	      transition: background-color 0.3s;
	      border: none;
	      cursor: pointer;
	      margin-right: 5px;
	    }

	    .view-repo-btn:hover {
	      background-color: #238a3b;
	    }
	    
	    .view-repo-btn-excluir {
	      background-color: #C41E3A;
	      color: white;
	      padding: 8px 16px;
	      border-radius: 6px;
	      text-decoration: none;
	      transition: background-color 0.3s;
	      border: none;
	      cursor: pointer;
	    }

	    .view-repo-btn-excluir:hover {
	      background-color: #D2042D;
	    }

	    /* Estado de erro */
	    .error {
	      background-color: #f8d7da;
	      border: 1px solid #f5c6cb;
	      padding: 15px;
	      border-radius: 6px;
	      margin: 20px 0;
	    }

	    .empty-state {
	      text-align: center;
	      padding: 40px;
	      color: #666;
	    }
	  </style>
	</head>
	<body>
	  <!-- Barra de navegação -->
	  <div class="navbar">
	    <div class="logo">nome do software</div>
		<div class="search-bar">
	      <input type="text" placeholder="Pesquisar repositórios...">
	    </div>
	    <a href="#" class="login-btn">Login</a>
	  </div>

	  <!-- Sidebar -->
	  <div class="sidebar">
   		<a style="cursor:pointer;" onclick="window.location.href = '/index'" class="repo-card">Início</a>
	  </div>

	  <!-- Conteúdo principal -->
	  <div class="content" id="vue-app">
	    <div class="title">Lista de Repositórios</div>

	    <div v-if="error && error.length > 0" class="error">
	      <strong>Erro ao carregar repositórios:</strong>
	      <p>{{ error }}</p>
	      <button @click="loadRepositories" style="margin-top: 10px; padding: 5px 10px; background: #007bff; color: white; border: none; border-radius: 3px;">
	        Tentar Novamente
	      </button>
	    </div>

	    <!-- Tabela de Repositórios -->
	    <div>
	      <div v-if="repositoriesCount > 0" style="margin-bottom: 20px;">
	        <span style="color: #666;">Total: {{ repositoriesCount }} repositórios</span>
	      </div>

	      <table v-if="repositoriesCount > 0" class="repo-table">
	        <thead>
	          <tr>
	            <th>Nome do Repositório</th>
	            <th>Ações</th>
	          </tr>
	        </thead>
	        <tbody>
	          <tr v-for="repo in repositories" :key="repo.id">
	            <td style="width: 300px;">{{ repo.nome }}</td>
	            <td style="width: 18%;">
	              <button @click="openRepository(repo.id)" class="view-repo-btn">
	                Abrir
	              </button>
	              <button @click="deleteRepository(repo.id, repo.nome)" class="view-repo-btn-excluir">
	                Excluir
	              </button>
	            </td>
	          </tr>
	        </tbody>
	      </table>
		  
			<div v-else class="empty-state">
			  <h3>Nenhum repositório encontrado</h3>
			  <p>Não há repositórios cadastrados no sistema.</p>	        
			</div>

			<div v-if="repositoriesColaboradosCount > 0" class="title" style="margin-bottom: 20px; margin-top: 20px;">
				Colaborando em:
			</div>

			<table v-if="repositoriesColaboradosCount > 0" class="repo-table">
			  <thead>
				<tr>
				  <th>Nome do Repositório</th>
				  <th>Ações</th>
				</tr>
			  </thead>
			  <tbody>
				  <tr v-for="repo in repositoriesColaborados" :key="repo.id">
					  <td>{{ repo.nome }}</td>
					  <td>
						  <button @click="openRepository(repo.id)" class="view-repo-btn">
							  Abrir
						  </button>
					  </td>
				  </tr>
			  </tbody>
			</table>
	    </div>
	  </div>

	  <script th:inline="javascript">
		// Dados vindos do servidor via Thymeleaf
		const serverRepositories = /*[[${repositories}]]*/ [];
		const serverRepositoriesCount = /*[[${repositoriesCount}]]*/ 0;
		const serverRepositoriesColaborados = /*[[${repositoriesColaborados}]]*/ [];
		const serverRepositoriesColaboradosCount = /*[[${repositoriesColaboradosCount}]]*/ 0;
	  </script>
	  
	  <script>
		const { createApp, ref, reactive, onMounted, nextTick } = Vue;
		
		createApp({
			setup() {
				// Estados reativos - inicializar com dados do servidor
				const repositories = reactive(serverRepositories.map(repo => ({
					id: repo.id,
					nome: repo.nome,
					descricao: repo.descricao
				})));
				const repositoriesCount = ref(serverRepositoriesCount);
				const repositoriesColaborados = reactive(serverRepositoriesColaborados.map(repo => ({
					id: repo.id,
					nome: repo.nome
				})));
				const repositoriesColaboradosCount = ref(serverRepositoriesColaboradosCount);
				const error = ref('');
				
				// Função para abrir repositório
				const openRepository = (repoId) => {
					window.location.href = `/repositorio/acessar?rep_id=${repoId}`;
				};
				
				// Função para excluir repositório
				const deleteRepository = async (repoId, repoName) => {
					if (!confirm(`Tem certeza que deseja excluir o repositório "${repoName}"?`)) {
						return;
					}
					
					try {						
						const response = await fetch(`/repositorio/excluirRepositorio?rep_id=${repoId}`);
						
						if (!response.ok) {
							throw new Error(`Erro HTTP: ${response.status}`);
						}
						
						// Remover da lista local
						const index = repositories.findIndex(repo => repo.id === repoId);
						if (index > -1) {
							repositories.splice(index, 1);
						}
						
						console.log('Repositório excluído:', repoId);
					} catch (err) {
						console.error('Erro ao excluir repositório:', err);
						error.value = err.message || 'Erro ao excluir repositório';
					}
				};
				
				// Retornar tudo que será usado no template Vue.js
				return {
					repositories,
					repositoriesCount,
					repositoriesColaborados,
					repositoriesColaboradosCount,
					error,
					openRepository,
					deleteRepository
				};
			}
		}).mount('#vue-app');
	  </script>
	</body>
	</html>

